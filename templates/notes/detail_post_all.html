{% extends "base.html" %}
{% load static %}
{% load blog_tags %}
{% block title %}{{ post.title }} — CYMOE{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{% static 'css/detail_post.css' %}">
<link rel="stylesheet" href="{% static 'css/comment.css' %}">
<link rel="stylesheet" href="{% static 'css/similar_posts.css' %}">
{% endblock %}

{% block content %}
<section class="detail">
  <div class="wrap">

    <div class="card head-card">
      <div class="head-top">
        <a class="back-btn" href="{% url 'blog:view_note' %}">
          ← Назад
        </a>

        <div class="right-top">
            <span class="badge badge-pub">Опубликовано</span>
            </p>
              {{ post.text|markdown }}
            <p>
        </div>
      </div>

      <div class="head-main">
        <h1 class="title">{{ post.title }}</h1>

        <div class="meta">
          <span class="meta-item">
            <span class="meta-label">Автор:</span>
            <span class="meta-value">{{ post.author }}</span>
          </span>
          <span class="dot" aria-hidden="true">•</span>
          <span class="meta-item">
            <span class="meta-label">Дата:</span>
            <span class="meta-value">{{ post.publish|date:"d.m.Y H:i" }}</span>
          </span>
        </div>
      </div>

      <div class="toolbar">
        <button class="tool" type="button" id="copyAllBtn" aria-label="Скопировать всю запись">
          Копировать всё
        </button>
        <button class="tool" type="button" id="copyTextBtn" aria-label="Скопировать только текст">
          Копировать текст
        </button>
        <button class="tool tool--ghost" type="button" id="selectBtn" aria-label="Выделить текст">
          Выделить
        </button>

        <div class="toast" id="toast" aria-live="polite" aria-atomic="true"></div>
      </div>
    </div>

    <div class="card body-card">
      <div class="paper">
        <div class="content" id="noteText">
          {{ post.text|markdown }}
        </div>
      </div>
    </div>

    <div class="bottom-actions">
      <a class="btn btn-ghost" href="{% url 'blog:view_note' %}">
        ← К записям
      </a>

      <a class="btn btn-primary" href="{% url 'blog:create_note' %}">
        Создать новую
        <span class="btn-glow" aria-hidden="true"></span>
      </a>
      <a class="btn btn-primary" href="{% url 'blog:post_share' post.id %}">
        Поделиться постом
        <span class="btn-glow" aria-hidden="true"></span>
      </a>
      <p class="tags">Tags: {{ post.tags.all|join:', ' }}</p>
    </div>

    <section class="comments-feed">
      {% with comments.count as total_comments %}
        <div class="comments-head">
          <h2 class="comments-title">Комментарии</h2>
          <span class="comments-count">{{ total_comments }}</span>
        </div>
      {% endwith %}

      <div class="comments-list">
        {% for comment in comments %}
          <article class="comment-item">
            <div class="comment-item-head">
              <span class="comment-author">{{ comment.name }}</span>
              <span class="comment-date">{{ comment.created|date:"d.m.Y H:i" }}</span>
            </div>
            <div class="comment-body">{{ comment.body|linebreaks }}</div>
          </article>
        {% empty %}
          <p class="comments-empty">Пока комментариев нет. Будьте первым, кто оставит мнение.</p>
        {% endfor %}
      </div>
    </section>

    <section class="similar-posts">
      <h2 class="similar-posts-title">Похожие записи</h2>
      <div class="similar-posts-list">
        {% for similar_post in similar_posts %}
          <p class="similar-post-item">
            <a class="similar-post-link" href="{{ similar_post.get_absolute_url }}">{{ similar_post.title }}</a>
          </p>
        {% empty %}
          <p class="similar-posts-empty">Похожих записей пока нет.</p>
        {% endfor %}
      </div>
    </section>

    {% include "includes/comment_form.html" %}

  </div>
</section>
{% endblock %}

{% block extra_js %}
<script src="{% static 'scripts/detail_post.js' %}"></script>
<script src="{% static 'scripts/comment.js' %}"></script>
{% endblock %}
